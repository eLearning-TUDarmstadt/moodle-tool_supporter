define(["jquery","core/ajax","core/templates","core/notification"],function(a,b,c,d){var e=function(e){var f=b.call([{methodname:"tool_supporter_get_assignable_roles",args:{courseID:e}}],!0,!0);f[0].done(function(b){c.render("tool_supporter/enrolusersection",b).done(function(b,d){a('[data-region="enroluserregion"]').replaceWith(b),a('[data-region="enroluserregion"]').show(),c.runTemplateJS(d)}).fail(d.exception)}).fail(d.exception)},f=function(){var e=b.call([{methodname:"tool_supporter_toggle_course_visibility",args:{courseID:a("#selectedcourseid")[0].textContent}}],!0,!0);e[0].done(function(b){c.render("tool_supporter/course_detail",b).done(function(b,d){a('[data-region="course_details"]').replaceWith(b),a('[data-region="course_details"]').show(),c.runTemplateJS(d)}).fail(d.exception)}).fail(d.exception)},g={showCourseDetail:function(f,g){"undefined"===g&&(g=0);var h=a("#course_details").offset().top;a("html, body").animate({scrollTop:h-50},"slow");var i=b.call([{methodname:"tool_supporter_get_course_info",args:{courseID:f}}]);return i[0].done(function(b){c.render("tool_supporter/course_detail",b).done(function(b,d){a('[data-region="course_details"]').replaceWith(b),a('[data-region="course_details"]').show(),c.runTemplateJS(d),1===a("#selecteduserid").length&&e(f)}).fail(d.exception)}).fail(d.exception),g?i:null},toggleCourseVisibility:function(){a("#hide_course_visibility").on("click",function(){f()}),a("#show_course_visibility").on("click",function(){f()})},toggleUserDetails:function(){a("#btn_hide_user_details, #btn_show_user_details").on("click",function(){a("#user_details_body").toggle(),a("#btn_hide_user_details").toggle(),a("#btn_show_user_details").toggle()})},toggleCourseDetails:function(){a("#btn_hide_course_details, #btn_show_course_details").on("click",function(){a("#course_details_body").toggle(),a("#btn_hide_course_details").toggle(),a("#btn_show_course_details").toggle()})},clickOnUser:function(f){a(f+" tbody").on("click","tr",function(){var g=a(this).find("td:first-child").text();if(!isNaN(g)){var h=a(f).dataTable()[0];a(h.rows).css("background-color",""),a(this).css("background-color","#bcbcbc");var i=a("#user_details").offset().top;a("html, body").animate({scrollTop:i-50},"slow");var j=b.call([{methodname:"tool_supporter_get_user_information",args:{userid:g}}]);j[0].done(function(b){c.render("tool_supporter/user_detail",b[0]).done(function(b,d){if(a('[data-region="user_details"]').replaceWith(b),a('[data-region="user_details"]').show(),a('[data-region="course_details"]').is(":visible")){var f=a("#selectedcourseid")[0].textContent;e(f)}c.runTemplateJS(d)}).fail(d.exception)}).fail(d.exception)}})},clickOnCourse:function(b){var c=this;a(b+" tbody").on("click","tr",function(){var d=a(this).find("td:first-child").text();if(!isNaN(d)){var e=a(b).dataTable()[0];a(e.rows).css("background-color",""),a(this).css("background-color","#bcbcbc"),c.showCourseDetail(d,!1)}})},clickOnRefresh:function(e,f,g){a("#btn_refresh_users").on("click",function(){var e=b.call([{methodname:f,args:g}]);e[0].done(function(b){c.render("tool_supporter/user_table",b).done(function(b,d){a('[data-region="user_table"]').replaceWith(b),c.runTemplateJS(d)}).fail(d.exception)}).fail(d.exception)}),a("#btn_refresh_courses").on("click",function(){var e=b.call([{methodname:f,args:g}]);e[0].done(function(b){c.render("tool_supporter/course_table",b).done(function(b,d){a('[data-region="course_table"]').replaceWith(b),c.runTemplateJS(d)}).fail(d.exception)}).fail(d.exception)})}};return g});